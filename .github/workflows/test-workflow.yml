name: Test Workflow Fix

on:
  push:
    branches: ["copilot/revise-workflows-ci"]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  # Test the root action
  test-root-action:
    name: "Test Root Action"
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write
    steps:
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1
      
      - name: Run Quality & Security Scanner
        uses: ./
        with:
          mode: 'all'
          github-token: ${{ secrets.GITHUB_TOKEN }}
          language: 'auto'

  # Test language detection action
  test-language-detect:
    name: "Test Language Detection"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1
      
      - name: Detect Language
        id: detect
        uses: ./.github/actions/language-detect
        with:
          override-language: auto
      
      - name: Display Result
        run: |
          echo "Detected Language: ${{ steps.detect.outputs.detected-language }}"
          echo "Has Node.js: ${{ steps.detect.outputs.has-nodejs }}"

  # Test reusable workflow
  test-reusable-quality:
    name: "Test Reusable Quality Workflow"
    uses: ./.github/workflows/quality-gate.yml
    permissions:
      contents: read
      pull-requests: write
    with:
      language: auto
      skip-lint: false
      skip-format: false
      skip-test: true  # Skip tests to speed up validation
      skip-build: true  # Skip build to speed up validation
      timeout-minutes: 10
    secrets: inherit
